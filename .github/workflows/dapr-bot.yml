name: dapr-bot

on:
  issue_comment:
    types: [created]

jobs:
  daprbot:
    name: bot-processor
    runs-on: ubuntu-latest
    steps:
      - uses: xt0rted/pull-request-comment-branch@v1
        id: comment_branch
      - uses: actions/checkout@v2
        if: success()
        with:
          ref: ${{ steps.comment_branch.outputs.head_ref }}
      - name: Checkout code
        if: ${{ steps.comment_branch.conclusion == 'failure' }}
        uses: actions/checkout@v2 # required to make the script available for next step
      - name: Comment analyzer
        uses: actions/github-script@v4
        with:
          github-token: ${{secrets.DAPR_BOT_TOKEN}}
          script: |
            const script = require('./.github/scripts/dapr_bot.js')
            await script({github, context})

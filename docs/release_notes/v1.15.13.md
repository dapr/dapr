# Dapr 1.15.13

This update includes bug fixes:

- [APP_API_TOKEN not passed in gRPC metadata for app callbacks](#app_api_token-not-passed-in-grpc-metadata-for-app-callbacks)
- [Fixed Pulsar OAuth token renewal](#fixed-pulsar-oauth-token-renewal)

## APP_API_TOKEN not passed in gRPC metadata for app callbacks

### Problem

When `APP_API_TOKEN` was configured, the token was not being passed in gRPC metadata for app callbacks including:
- PubSub subscriptions
- Bindings
- Jobs

This meant that applications using gRPC protocol could not authenticate incoming requests from Dapr when using the app API token security feature.

### Impact

Applications that configured `APP_API_TOKEN` to secure their endpoints could not validate that incoming gRPC requests were from their Dapr sidecar. This broke the app API token authentication feature for gRPC applications.

### Root Cause

The gRPC subscription delivery, binding, and job callback code paths were directly calling the app's gRPC client without going through the channel layer abstraction. The channel layer is responsible for injecting the `APP_API_TOKEN` in the `dapr-api-token` metadata header, but these direct calls bypassed this mechanism.

### Solution

Centralized the `APP_API_TOKEN` injection logic in a helper function (`AddAppTokenToContext`) in the gRPC channel layer. Updated all gRPC app callback code paths (pubsub subscriptions, bindings, and job callbacks) to use this helper, ensuring the token is consistently added to the outgoing gRPC context metadata. Added comprehensive integration tests to verify token passing for all callback scenarios in both HTTP and gRPC protocols.

## Fixed Pulsar OAuth token renewal

### Problem

The pulsar pubsub component was not renewing the OAuth token when it expired.

### Impact

Applications using the pulsar pubsub component could not receive/publish messages when the OAuth token expired.

### Root Cause

There was a bug in the component code that was preventing the OAuth token from being renewed when it expired.

### Solution

Fixed the bug in the component code ensuring the OAuth token is renewed when it expires. Also added a test to verify the token renewal functionality. Fixed in https://github.com/dapr/components-contrib/pull/4079

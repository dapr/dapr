# Dapr 1.16.1

This update includes bug fixes:

- [Actor Initialization Timing Fix](#actor-initialization-timing-fix)
- [Sidecar Injector Crash with Disabled Scheduler](#sidecar-injector-crash-with-disabled-scheduler)
- [Workflow actors reminders stopped after Application Health check transition](#workflow-actors-reminders-stopped-after-application-health-check-transition)
- [Fix Scheduler Etcd client port networking in standalone mode](#fix-scheduler-etcd-client-port-networking-in-standalone-mode)
- [Component initialization timeout check before using reporter](#component-initialization-timeout-check-before-using-reporter)

## Actor Initialization Timing Fix

### Problem
When running Dapr with an `--app-port` specified but no application listening on that port (either due to no server or delayed server startup), the actor runtime would initialize immediately before the app channel was ready. This created a race condition where actors were trying to communicate with an application that wasn't available yet, resulting in repeated error logs:

```
WARN[0064] Error processing operation DaprBuiltInActorNotFoundRetries. Retrying in 1sâ€¦
DEBU[0064] Error for operation DaprBuiltInActorNotFoundRetries was: failed to lookup actor: api error: code = FailedPrecondition desc = did not find address for actor
```

### Impact
This created a poor user experience with confusing error messages when users specified an `--app-port` but had no application listening on that port.

### Root cause
The actor runtime initialization was occurring before the application channel was ready, creating a race condition where actors attempted to communicate with an unavailable application.

### Solution
Defer actor runtime initialization until the application channel is ready. The runtime now:

1. Defers actor runtime initialization until the application is listening on the specified port
2. Provides informative `waiting for application to listen on port XXXX` messages instead of confusing error logs
3. Prevents actor lookup errors during startup

## Sidecar Injector Crash with Disabled Scheduler

### Problem
The sidecar injector crashes with error (`dapr-scheduler-server StatefulSet not found`) when the scheduler is disabled via Helm chart (`global.scheduler.enabled: false`).

### Impact
The crash prevents the sidecar injector from functioning correctly when the scheduler is disabled, disrupting deployments.

### Root cause
A previous change caused the `dapr-scheduler-server` StatefulSet to be removed when the scheduler was disabled, instead of scaling it to 0 as originally intended. The injector, hardcoded to check for the StatefulSet in the `injector.go` file, fails when it is not found.

### Solution
Revert the behavior to scale the `dapr-scheduler-server` StatefulSet to 0 when the scheduler is disabled, instead of removing it, as implemented in the Helm chart.


## Workflow actors reminders stopped after Application Health check transition

### Problem
Application Health checks transitioning from unhealthy to healthy were incorrectly configuring the scheduler clients to stop watching for actor reminder jobs.

### Impact
The misconfiguration in the scheduler clients made workflows to stop executing because reminders no longer executed.

### Root cause
On Application Health change daprd was able to trigger an actors update for an empty slice, which caused a scheduler client reconfiguration. However because there were no changes in the actor types, daprd never received a new version of the placement table which caused the scheduler clients to get misconfigured. This happens because when daprd sends an actor types update to the placement server daprd wipes out the known actor types in the scheduler client, and because daprd never received an acknowledgement from placement with a new table version then the scheduler client never got updated back with the actor types.

### Solution
Prevent any changes to hosted actor types if the input slice is empty

## Fix Scheduler Etcd client port networking in standalone mode

### Problem

The Scheduler Etcd client port is not available when running in Dapr CLI standalone mode.

### Impact

Cannot perform Scheduler Etcd admin operations in Dapr CLI standalone mode.

### Root cause

The Scheduler Etcd client port is only listened on localhost.

### Solution

The Scheduler Etcd client listen address is now configurable via the `--scheduler-etcd-client-listen-address` CLI flag, meaning port can be exposed when running in standalone mode.

## Fix Helm chart not honoring --etcd-embed argument

### Problem

The Scheduler would always treat `--etcd-embed` as true, even when set to false in the context of the Helm chart.

### Impact

Cannot use external etcd addresses since Scheduler would always assume embedded etcd is used.

### Root cause

The Helm template format treated the boolean argument as a seperate argument rather than inline.

### Solution

The template format string was fixed to allow for `.etcdEmbed` to be set to `false`.

## Component initialization timeout check before using reporter

### Problem
The Component init timeout was checked after using the component reporter

### Impact
This misalignment could lead to false positives, dapr could have reported success when later dapr was returning an error due the timeout check

### Solution
Move the timeout check to be right after the actual component initialization and before the component reporter

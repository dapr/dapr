# Dapr 1.16.2

This update includes bug fixes:

- [HTTP API default CORS behavior](#http-api-default-cors-behavior)
- [Scheduler External etcd with multiple client endpoints](#scheduler-external-etcd-with-multiple-client-endpoints)
- [Placement not cleaning internal state after host that had actors disconnects](#placement-not-cleaning-internal-state-after-host-that-had-actors-disconnects)
- [Blocked Placement dissemination during high churn](#blocked-placement-dissemination-during-high-churn)

## HTTP API default CORS behavior

### Problem
In the 1.16.0 release a change was introduced that changed the default behavior of CORS in the Dapr HTTP API. Now by default CORS headers were added to all HTTP responses. However this new behavior couldn't be disabled.

### Impact
This caused problems in scenarios where CORS is handled outside of the Dapr sidecar, because the Dapr Sidecar always added CORS headers.

### Solution
Revert part of the behavior introduced in this [PR](https://github.com/dapr/dapr/pull/9025) and change the default value of `allowed-origins` flag to be an empty string, and disabling the CORS filter by default.

## Scheduler External etcd with multiple client endpoints

### Problem

Using Scheduler in non-embed mode with multiple etcd client endpoints was not working.

### Impact

It was not possible to use multiple etcd endpoints for high availability with an external etcd database for scheduler.

### Root Cause

The Scheduler etcd client endpoints CLI flag was typed as an string array, rather than a string slice, causing the given value to be parsed as a single string rather than a slice of strings.

### Solution

Changed the type of the etcd client endpoints CLI flag to be a string slice.

## Placement not cleaning internal state after host that had actors disconnects

### Problem

An actor host that had actors doesn't get properly cleaned up from placement after the sidecar is scaled down and the placement stream is closed.

### Impact

This results in the placement server iterating over namespaces that no longer exist for every tick of the disseminate ticker.

### Root Cause

The function `requiresUpdateInPlacementTables` sould not set `isActorHost` to false once it is set to true, because once a host has actors the placement server keeps internal state for it and cleanup logic must be executed once the host disconnects.

### Solution

Update the logic in `requiresUpdateInPlacementTables`.

## Blocked Placement dissemination during high churn

### Problem

Placement would fail to ever, or very slowly, disseminate the actor table in high daprd churn scenarios.

### Impact

Actors or workflows would fail to be activated, and existing actors or workflows would fail.

### Root Cause

Placement used a "small" (100) queue size which when exhausted would cause a deadlock. Placement would also wait for a fully consumed channel queue before disseminating slowing down the dissemination process.

### Solution

Increase the queue size to 10000 and change the dissemination logic to not wait for a fully consumed queue before disseminating.
